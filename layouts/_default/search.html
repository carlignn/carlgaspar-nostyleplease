{{ define "main" }}
{{ partial "back_link.html" .}}

<link rel="modulepreload" href="/pagefind/pagefind.js">

<input type="text" id="search-input" placeholder="Search..." autocomplete="off" data-pagefind-ignore>

    <ul id="search-results"></ul>
    <div id="search-loading" style="display: none; text-align: center; font-style: italic;">Loading...</div>
    <script>
        (async function() {
            const pagefind = await import('/pagefind/pagefind.js');
            await pagefind.init();
            await pagefind.preload('');

            const input = document.getElementById('search-input');
            const results = document.getElementById('search-results');
            const loading = document.getElementById('search-loading');

            input.addEventListener('input', async (e) => {
                const query = e.target.value;
                results.innerHTML = '';

                if (query.length < 2) {
                    loading.style.display = 'none';
                    return;
                }

                loading.style.display = 'block';
                const search = await pagefind.search(query);
                for (const result of search.results.slice(0, 20)) {
                    const data = await result.data();
                    const li = document.createElement('li');
                    const date = data.meta?.date || '';
                    const title = data.meta?.title?.toLowerCase() || data.url;
                    li.innerHTML = `
            <span>${date}</span>
            <a href="${data.url}">${title}</a>`;
                    results.appendChild(li);
                }
                loading.style.display = 'none';
            });
        })();
    </script>

{{ end }}
