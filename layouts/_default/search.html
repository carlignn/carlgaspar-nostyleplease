{{ define "main" }}
{{ partial "back_link.html" .}}

<input type="text" id="search-input" placeholder="Search..." data-pagefind-ignore>

    <ul id="search-results"></ul>
    <script>
        (async function() {
            const pagefind = await import('/pagefind/pagefind.js');
            const input = document.getElementById('search-input');
            const results = document.getElementById('search-results');

            input.addEventListener('input', async (e) => {
                const query = e.target.value;
                results.innerHTML = '';

                if (query.length < 2) return;

                const search = await pagefind.search(query);
                for (const result of search.results.slice(0, 20)) {
                    const data = await result.data();
                    const li = document.createElement('li');
                    const date = data.meta?.date || '';
                    const title = data.meta?.title?.toLowerCase() || data.url;
                    li.innerHTML = `
            <span>${date}</span>
            <a href="${data.url}">${title}</a>`;
                    results.appendChild(li);
                }
            });
        })();
    </script>

{{ end }}
