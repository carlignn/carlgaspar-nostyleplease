<!DOCTYPE html>
<html lang="en" class=""><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>
    
      My OPNSense Documentation
    
  </title>

  
  <meta name="description" content="Hardware I have no choice but to buy a new hardware because we moved to a new place, therefore the internet has changed too - for the worse. Just like before, …" />
  <meta name="author" content="Carl Gaspar" />
  
  <link rel="canonical" href="http://10.10.30.2:1313/homelab/my-opnsense-documentation/" />

  
  <meta property="og:title" content="My OPNSense Documentation" />
  <meta property="og:description" content="Hardware I have no choice but to buy a new hardware because we moved to a new place, therefore the internet has changed too - for the worse. Just like before, it has the option to configure subnet but …" />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="http://10.10.30.2:1313/homelab/my-opnsense-documentation/" />
  <meta property="og:site_name" content="Carl Gaspar" />
  
  
  <meta property="article:published_time" content="2025-08-27T00:00:00&#43;08:00" />
  <meta property="article:modified_time" content="2025-08-27T00:00:00&#43;08:00" />
  

  
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="My OPNSense Documentation" />
  <meta name="twitter:description" content="Hardware I have no choice but to buy a new hardware because we moved to a new place, therefore the internet has changed too - for the worse. Just like before, it has the option to configure subnet but …" />
  

  
  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "My OPNSense Documentation",
    "datePublished": "2025-08-27T00:00:00\u002b08:00",
    "dateModified": "2025-08-27T00:00:00\u002b08:00",
    "author": {
      "@type": "Person",
      "name": "Carl Gaspar"
    },
    "description": "Hardware I have no choice but to buy a new hardware because we moved to a new place, therefore the internet has changed too - for the worse. Just like before, it has the option to configure subnet but …"
  }
  </script>
  

  <link rel="shortcut icon" type="image/x-icon" href="/logo.png" />
  
  
  
  <link rel="stylesheet" href="/css/main.css" />
  <script>
    
    (function() {
      
      var saved = localStorage.getItem('theme') || localStorage.getItem('darkMode');

      if (saved) {
        document.documentElement.setAttribute('data-theme', saved);
        
        if (!localStorage.getItem('theme')) {
          localStorage.setItem('theme', saved);
          localStorage.removeItem('darkMode');
        }
      } else {
        
        var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        var theme = prefersDark ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', theme);
        
      }
    })();
  </script>
  
  
</head>
<body data-theme="light">
        <main class="page-content" aria-label="Content">
            <div class="w">
<a href="/">..</a>

<article data-pagefind-body>
    <span data-pagefind-meta="date" style="display: none;">2025-08-27</span>
    <p class="post-meta">
        <time datetime="2025-08-27 00:00:00 &#43;0800 &#43;0800">
            
                2025-08-27
            
        </time>
    </p>

    <h1 data-pagefind-meta="title">My OPNSense Documentation</h1>

    <div data-pagefind-ignore>
    
        
        
        
            
        
            
                
            
        
        
            <p style="font-size: 75%; margin-left: 4%;">tags: <a href="/tags/documentation">documentation</a></p>
        
    

    <p></p>

    <h2 id="hardware">Hardware</h2>
<p>I have no choice but to buy a new hardware because we moved to a new place, therefore the internet has changed too - for the worse. Just like before, it has the option to configure subnet but it&rsquo;s not working!</p>
<p>My options were the NanoPI R5S router, Gl.inet stuff, then this one - the Lenovo m720q - the best mini PC that you could get for cheap.</p>
<p>I chose this one because of the upgradability and <em>aesthetics</em>, and the price difference is also not that high so might as well settle for the one that pleases my eyes the most.</p>
<ul>
<li>Chassis - <a href="https://shopee.ph/Lenovo-M710Q-M720Q-M73-Mini-Desktop-Computer-I3i5-Quad-Core-Commercial-Office-Finance-Mini-Host-i.1290300602.27804148815">Lenovo m720q mini PC</a></li>
<li>CPU - Intel i5 8500T</li>
<li>System storage - <a href="https://shopee.ph/Kingston-NV1-M.2-Nvme-SSD-250GB-500GB-1TB-PcIe-2280-Solid-State-Hard-Drive-For-Laptop-Desktop-PC-i.745034587.22835084403">Kingston NV1 M.2 Nvme</a> - 120gb * 1</li>
<li>RAM - <a href="https://shopee.ph/Kingston-Hyperx-Impact-Laptop-DDR4-RAM-4GB-8GB-16GB-2133-2400Mhz-2666Mhz-3200Mhz-SOIDMM-RAM-Memory-i.745034587.24265223941">Kingston Hyperx 2666mhz</a> - 16gb * 1 (this is from one of my Lenovo mini PC, I can&rsquo;t justify buying a new 8gb stick for this)</li>
<li>NIC - <a href="https://shopee.ph/2-Port-Gigabit-PCIe-Network-Card-1000M-Dual-Ports-PCI-Express-Ethernet-Adapter-with-82571EB-LAN-NIC-Card-for-Windows-i.181060955.19440116949">2-Port Gigabit PCIe network card</a> - this is an old NIC that I was planning on using with my NAS but ended up not doing so. Good thing I remembered I have this before buying a new one</li>
<li>Misc - <a href="https://shopee.ph/-UTnus9ddL-PCI-E-Graphic-Card-Adapter-Card-Tiny-4-Riser-Card-for-Lenovo-Tiny4-Series-Models-M720Q-01AJ940-PCIE-Riser-Card-i.371192636.26516030851">Riser card adapter</a></li>
</ul>
<h2 id="setup">Setup</h2>
<p>Diagram: Modem/Router &gt; OPNSense Firewall &gt; Switch &gt; Devices</p>
<p>For this setup, I&rsquo;ve decided to not put my modem into bridge mode and use it as a regular WiFi. I don&rsquo;t want to go through the stress of routing all our (mobile phones) traffic through my entire network. So this will just do for now.</p>
<p>From the command line (directly connected to OPNSense) setup the interface. Bind the <strong>WAN</strong> to the port between the firewall and the modem, and <strong>LAN</strong> to the port between the firewall and the switch.</p>
<ul>
<li>WAN IP 192.168.0.2</li>
<li>LAN IP 10.10.0.1</li>
</ul>
<p>In the web interface (LAN IP) &gt; Go to System &gt; Firmware &gt; Updates and update OPNSense.</p>
<p>I&rsquo;d like my setup to be as simple as possible, a WAN and a LAN (I only have one switch, for now).</p>
<p>Go to Interface &gt; WAN/LAN &gt; Enable Interface &gt; Set the IP address to static on IPv4 (because I want it to be static) &gt; Disable IPv6 (case-to-case basis) &gt; The subnet will be at /16 for the meantime.</p>
<h3 id="firewall">Firewall</h3>
<p>For some reason, the NATting is not working automatically by default. I have to set it to hybrid for it to work. Go to Firewall &gt; NAT &gt; Outbound &gt; Chec Hybrid &gt; Add any to any rule.</p>
<h3 id="dns">DNS</h3>
<p>For some reason, the machines are not being provided with DNS (only DHCP). You need to check what services are running. Go to Lobby &gt; Dashboard &gt; Services. There I found the culprit - Dnsmasq DNS &amp; DHCP are enabled. I just had to disable it  in Services &gt; Dnsmasq DNS &amp; DHCP &gt; General &gt; Uncheck Enable.</p>
<p>Then set it up with the (outdated) ISC DHCPv4. Go to Servcices &gt; LAN &gt; Enable &gt; And setup the DHCP Range, DNS servers (10.10.10.5, 1.1.1.1), and Gateway (10.10.0.1).</p>
<h4 id="unbound">Unbound</h4>
<p><del>I just found out the Unbound DNS was enabled by default. If I&rsquo;m not using pihole, I&rsquo;d just use this one since it&rsquo;s better looking and easier to manage. Disabling..</del></p>
<ul>
<li>Go to Services &gt; Unbound DNS &gt; General &gt; Enable Unbound
<ul>
<li>Blocklist &gt; Type of DNSBL &gt; Steven Black List (This one blocks ads)</li>
</ul>
</li>
<li>Change DNS  servers in Services &gt; ISC DHCPv4 &gt; LAN &gt; DNS servers &gt; Put the OPNSense IP
<ul>
<li>Same on System &gt; Settings &gt; General &gt; DNS servers</li>
</ul>
</li>
<li>Enable Unbound DNS Reporting, go to Reporting &gt; Unbound DNS &gt; Go to the Reporting configuration &gt; Enable local gathering of statistics
<ul>
<li>Reset DNS on devices</li>
</ul>
</li>
</ul>
<p><a href="https://www.youtube.com/watch?v=NdvKIAMfnUM">Guide</a></p>
<h2 id="vlans">VLANs</h2>
<p>I want to configure VLANs but I don&rsquo;t have the capacity for that yet. I think I&rsquo;m not smart enough as of the moment. For the meantime, everything is on /16 subnet so that they could all see each other :))</p>
<h2 id="tailscale">Tailscale</h2>
<p>Wow, OPNSense has a Tailscale plugin. This had made things a lot easier. Go to System &gt; Firmware &gt; Plugins &gt; Check Show community plugins &gt; Add tailscale &gt; Tailscale should start showing up in the VPN tab together with other VPN providers</p>
<p>I chose tailscale because of ease of use. I want people to be able to connect to my network then my NAS for their storage needs, and tailscale is the app for that.</p>
<p>To set it up, go to VPN &gt; Tailscale &gt; Authentication and put in the auth keys from your Tailscale client. Then go to settings and enable it. If you want to use it as an Exit Node, just check the box. Make sure to add your subnet to the Advertised Routes tab. I have added 10.10.0.0/16 to cover the entire <a href="/tags/homelab">homelab</a>. It feels unsafe but it can change in the future after researching more.</p>
<h3 id="problems">Problems</h3>
<ul>
<li>My DNS is not resolving when I&rsquo;m connected to the VPN but on LAN.
<ul>
<li>I have to add the IP of my OPNSense in Tailscale Web &gt; DNS &gt; Global name servers</li>
<li>Then Override DNS servers</li>
<li>Bonus - enable split tunneling to make accessing websites other than the homelab faster</li>
</ul>
</li>
<li>When ssh-ing to a machine using the dns name, it&rsquo;s redirecting to NGINX Proxy Manager instead of the machine itself.
<ul>
<li>I have to add an additional entry in OPNSense (hl1proxmox1-<strong>ssh</strong>..) and assign it with the actual IP of the machine</li>
</ul>
</li>
</ul>
<h2 id="ntop"><del>Ntop</del></h2>
<ul>
<li>This has been uninstalled. I just don&rsquo;t see any use for it as of the moment</li>
<li>Go to System &gt; Firmware &gt; Plugins and install nTop and redis</li>
<li>Go to Services &gt; Enable Redis</li>
<li>Go to Services &gt; Enable Ntopng
<ul>
<li>HTTPS Port - 3001</li>
<li>Certificate - Web GUI TLS certificate</li>
</ul>
</li>
</ul>
<h2 id="notification">Notification</h2>
<p><a href="/homelab/my-notification-documentation">My Notification Documentation</a></p>
<h2 id="backup">Backup</h2>
<p>To backup the configuration, I figured it would be easier to do it automatically. Go to System &gt; Firmware &gt; Plugins &gt; Show comunity plugins &gt; Search for backup &gt; Install os-sftp-backup</p>
<p>This is too much, I think. Aborting..</p>
<p><a href="https://docs.opnsense.org/manual/sftp-backup.html">Guide</a></p>

    </div>
</article>


<div class="comments">
  <script>
    (function() {
      var theme = document.documentElement.getAttribute('data-theme') || 'light';
      var script = document.createElement('script');
      script.src = 'https://giscus.app/client.js';
      script.setAttribute('data-repo', 'carlignn\/carlgaspar-nostyleplease');
      script.setAttribute('data-repo-id', 'R_kgDOIDaPAw');
      script.setAttribute('data-category', 'Comments');
      script.setAttribute('data-category-id', 'DIC_kwDOIDaPA84Cz6IE');
      script.setAttribute('data-mapping', 'pathname');
      script.setAttribute('data-strict', '0');
      script.setAttribute('data-reactions-enabled', '1');
      script.setAttribute('data-emit-metadata', '0');
      script.setAttribute('data-input-position', 'top');
      script.setAttribute('data-theme', theme);
      script.setAttribute('data-lang', 'en');
      script.setAttribute('data-loading', 'lazy');
      script.setAttribute('crossorigin', 'anonymous');
      script.async = true;
      document.currentScript.parentNode.appendChild(script);
    })();
  </script>
</div>



            </div>
        </main>
	
	<script type="text/javascript" src="/js/theme_toggle.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/han-css@3/dist/han.min.js"></script>
    </body>
</html>
